{% set bodyClass = 'home' %}

{% extends "_layouts/site" %}

{% block main %}

<!-- Hero -->
<section class="home__hero grid-y align-center">

  <div class="swiper-container carousel--hero home__hero__image">
    <div class="swiper-wrapper">
      {% for image in entry.heroImages.orderBy('RAND()').all() %}
      <div class="swiper-slide small-12 cell text-center">
        <div class="image--hero align-center-middle" data-interchange="{% include "_includes/images/full/full/interchange-img-small-12-medium-12" %}">
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <div class="shrink cell white">
    <div class="grid-container">
      <div class="grid-x grid-padding-x">
        <div class="small-12 large-8 cell secondary-font text-uppercase">
        {% set promo = random(entry.heroText) %}
        <h1>{{ promo.text }}</h1>
        </div>
        <div class="small-12 large-4 cell">
          <div class="grid-y align-justify" style="height: 100%;">
            <div class="shrink cell">
              <div class="text-uppercase margin-top-2">{{entry.heroSubheader}}</div>
            </div>
            <div class="shrink cell">
              <div class="margin-top-1 margin-bottom-1"><a href="/redirection" class="button large text-uppercase solid secondary-button">Click for Beer<svg class="icon icon-arrow_forward"><use xlink:href="/assets/icons/symbol-defs.svg#icon-arrow_forward"></use></svg></a></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</section>
<!-- End Hero -->

<!-- Campaign -->
{% if entry.showCampaign %}
<section class="home__campaign">

  <div class="grid-x">
    <div class="small-12 cell">
    
      {% set image = entry.campaignImage.one() %}
      <div class="image--campaign align-center-middle" data-interchange="{% include "_includes/images/full/full/interchange-img-small-12-medium-12" %}">
        <div class="grid-y height-100 align-center">
          <div class="shrink cell text-center padding-2" id="video-gallery">
            <a href="https://www.youtube.com/watch?v=CciUPWG6Kp8" class="h1 white play_arrow"><svg class="icon icon-play_arrow"><use xlink:href="/assets/icons/symbol-defs.svg#icon-play_arrow"></use></svg></a>
          </div>
        </div>
      </div>
    
    </div>
  </div>

</section>
{% endif %}
<!-- End Campaign -->

<!-- Location -->
<section class="home__drink inverted" id="home__drink">

  <div class="grid-container">
    <div class="grid-x grid-padding-x grid-padding-y">
      <div class="small-12 medium-auto large-8 cell">
        <h1 class="secondary-font margin-bottom-0 text-uppercase">Drink</h1>
      </div>
      <div class="small-12 medium-shrink large-4 cell text-uppercase align-self-bottom">
        <button class="button text-uppercase findbeer solid large primary-button">Find Beer <svg class="icon icon-arrow_forward"><use xlink:href="/assets/icons/symbol-defs.svg#icon-arrow_forward"></use></svg></button>
      </div>
    </div>  
  </div>

</section>

<div id="map" style="width: 100%; height: 500px;"></div>

<!-- Party Video -->
{% if entry.partyVideo | length %}
<section class="home__party-video">
    {% set video = entry.partyVideo.one() %}
    <video playsinline autoplay muted loop class="video" poster="">
      <source src="https://storage.googleapis.com/old-blue-last-beer/{{ video.filename }}" type="video/mp4">
    </video>
</section>
 {% endif %}
<!-- End Party Video -->

<!-- Party -->
<section class="home__party" id="home__party">

  <div class="grid-container">
    <div class="grid-x grid-padding-x grid-padding-y">
      <div class="small-12 medium-8 cell">
      <h1 class="secondary-font margin-bottom-0 text-uppercase">Party</h1>
      {{entry.partyText}}
      </div>
    </div>
  </div>

</section>
<!-- End Party -->

<!-- Upcoming Events -->
{% set entries = craft.entries
.section('events')
.eventDate('>' ~ now.getTimestamp())
.orderBy('eventDate asc')
.all() %}

{% if entries|length %}
<section class="home__upcoming-events" id="home__events">

  <div class="grid-container">
    <div class="grid-x grid-padding-x grid-padding-y">
      <div class="small-12 cell text-uppercase">
        <h1 class="secondary-font margin-bottom-0 text-uppercase">Upcoming Events</h1>
      </div>
    </div>
  </div>

  <ul class="vertical menu home__upcoming-events__list">
  
  {% for entry in entries %}
    <li>
  	  <a href="{{ entry.eventFacebookLink}}" class="padding-left-0 padding-top-2 padding-bottom-1" target="_blank">
  	  
  	    <div class="grid-container">
          <div class="grid-x grid-padding-x">
          
            <div class="small-12 medium-8 cell text-uppercase">
              <h5>{{ entry.eventDate | date('D j M') }}</h5>
              <h4>{{ entry.title}} @ {% if entry.eventVenue|length %}{{ entry.eventVenue }},{% endif %} {{ entry.eventLocation }}</h4>
            </div>
            
            <div class="small-12 medium-4 cell text-uppercase text-left medium-text-right align-self-bottom margin-bottom-1">
              <span class="underline">Event Page</span>
            </div>
          
          </div>
        </div>
  	  
  	  </a>
    </li>
  {% endfor %}
  </ul>
  
</section>
{% endif %}
<!-- End Upcoming Events -->

<!-- Photos -->

{% set evententries = craft.entries.section('events')
.eventFeatured('1')
.eventDate('< ' ~ now.getTimestamp())
.limit(9)
.all() %}

<section class="home__photos" id="home__photos">

    <div class="inverted">
      <div class="grid-container">
        <div class="grid-x grid-padding-x grid-padding-y">
          <div class="small-12 medium-auto large-8 cell text-uppercase">
            <h1 class="secondary-font text-uppercase">Photos</h1>
          </div>
          <div class="small-12 medium-shrink large-4 cell text-uppercase align-self-bottom">
            <a href="/photos" class="button text-uppercase solid large primary-button">View All <svg class="icon icon-arrow_forward"><use xlink:href="/assets/icons/symbol-defs.svg#icon-arrow_forward"></use></svg></a>
          </div>
        </div>
      </div>
    </div>
    
    <div class="grid-x small-up-1 medium-up-3 large-up-3">
      {% for entry in evententries %}
      <div class="cell">
        <a href="{{ entry.url}}" class="global__photos">   
          {% for image in entry.eventThumb.all() %}
          <div class="image--square" data-interchange="{% include "_includes/images/full/1-1/interchange-img-small-12-medium-4" %}">
            <div class="grid-y height-100 align-center content">
              <div class="shrink cell text-center padding-2">
                <h4 class="margin-bottom-0">{{ entry.title}}<br>@ {{ entry.eventVenue}}</h4>
              </div>
            </div>
          </div>
          {% endfor %}
        </a>
      </div>
      {% endfor %}
    </div>

</section>

<!-- End Photos -->

<!-- The Beer -->
<section class="home__the-beer" id="home__the-beer">
  <div class="grid-container">
    <div class="grid-x grid-padding-x grid-padding-y">
      <div class="small-12 medium-8 cell">
      <h1 class="secondary-font margin-bottom-0 text-uppercase">The Beer</h1>
      {{entry.theBeerText}}
      </div>
    </div>
  </div>
</section>
<!-- End The Beer -->

<!-- Contact Form -->
<section class="home__contact padding-vertical-2" id="home__contact">
  <div class="grid-container">
    <div class="grid-x">
      <div class="small-12 medium-8 cell">
      <h1 class="secondary-font margin-bottom-0 text-uppercase">Contact</h1>
      {% include "_includes/blocks/form" %}
      </div>
    </div>
  </div>
</section>
<!-- End Contact Form  -->

{% js %}
mapboxgl.accessToken = "pk.eyJ1IjoiZ2FyZXRoam9obnNkZXNpZ24iLCJhIjoiY2sxbnV1NGhmMGE4YTNvb2l1aGp5ano3ZiJ9.g6KdDp-CdRZI2KzanoxFQw";

var map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/garethjohnsdesign/ck1qcw4jy09aj1cpdwf0xqiec?optimize=true',
  center: [-0.0800221, 51.5242972],
  zoom: 12
});

var geojson = {
  type: 'FeatureCollection',
  features: 
  [
  {% set locations = craft.entries
  .section('locations')
  .all() %}
  {% for entry in locations %}
  {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [{{ entry.location.lng }}, {{ entry.location.lat }}]
    },
    properties: {
      title: '{{entry.title }}',
      description: '{{ entry.location.parts.number }} {{ entry.location.parts.address }}'
    }
  },
  {% endfor %}
  ]
};
 
  // add markers to map
  geojson.features.forEach(function(marker) {

  // create a HTML element for each feature
  var el = document.createElement('div');
  el.className = 'marker';

  // make a marker for each feature and add to the map
  new mapboxgl.Marker(el)
    .setLngLat(marker.geometry.coordinates)
    .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
    .setHTML('<h6 class="primary-color secondary-font margin-bottom-1">' + marker.properties.title + '</h6><div class="primary-color">' + marker.properties.description + '</div>'))
    .addTo(map);
});

map.addControl(new mapboxgl.NavigationControl(), 'top-left');
map.addControl(new mapboxgl.GeolocateControl ({positionOptions: {enableHighAccuracy: true},trackUserLocation: true}), 'top-left');

// disable map zoom when using scroll
map.scrollZoom.disable();

{% endjs %}

{% endblock %}