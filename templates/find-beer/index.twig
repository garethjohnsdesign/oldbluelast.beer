{% extends "_layouts/site" %}

{% block main %}

{% set target = craft.request.getParam('near') %}
{% if target %}
    {% set params = {
        target: target,
        range: 500
    } %}
    {% set locations = craft.entries.section('locations').address(params).order('distance').all() %}
{% else %}
    {% set locations = craft.entries.section('locations').all() %}
{% endif %}

{% set options = {
    height: 500,
    zoom: 15,
    draggable: true,
    markerInfo: '_includes/map/bubble',
    markerOptions: {
        icon: 'https://maps.google.com/mapfiles/ms/icons/green-dot.png'
    },
    infoWindowOptions: {
        maxWidth: 200
    }
} %}

<div class="grid-container">
  <div class="grid-x grid-padding-x grid-padding-y small-up-3 margin-top-2">
    {% for entry in locations %}
    <div class="cell">
    <h4>{{ entry.title }}</h4>
    <h6>{{ entry.address.street1 }}<h6>
    <h6>{{ entry.address.city }}, {{ entry.address.zip }}<h6>
    </div>
    {% endfor %}
  </div>
</div>

<section class="inverted">
<div class="grid-container">
  <div class="grid-x grid-padding-x grid-padding-y margin-top-2">
  <div class="small-12 cell">
  <form action="" method="GET">
    <input name="near" type="text" placeholder="Enter your postcode">
    <input type="submit" class="button" value="Submit">
  </form>
  </div>
  </div>
</div>
</section>

<div class="grid-x">
  <div class="small-12 cell">
    {{ craft.smartMap.map(locations, options) }}
  </div>
</div>

{% js %}

$(function () {
        var styles = [
 {
   "elementType": "geometry",
   "stylers": [
     {
       "color": "#f5f5f5"
     }
   ]
 },
 {
   "elementType": "geometry.stroke",
   "stylers": [
     {
       "color": "#242965"
     },
     {
       "saturation": 5
     },
     {
       "weight": 2
     }
   ]
 },
 {
   "elementType": "labels.icon",
   "stylers": [
     {
       "color": "#272a67"
     },
     {
       "visibility": "off"
     }
   ]
 },
 {
   "elementType": "labels.text.fill",
   "stylers": [
     {
       "color": "#272a67"
     },
     {
       "saturation": -5
     }
   ]
 },
 {
   "elementType": "labels.text.stroke",
   "stylers": [
     {
       "saturation": -90
     }
   ]
 },
 {
   "featureType": "administrative.land_parcel",
   "elementType": "labels",
   "stylers": [
     {
       "visibility": "off"
     }
   ]
 },
 {
   "featureType": "administrative.land_parcel",
   "elementType": "labels.text",
   "stylers": [
     {
       "color": "#242965"
     }
   ]
 },
 {
   "featureType": "administrative.land_parcel",
   "elementType": "labels.text.fill",
   "stylers": [
     {
       "color": "#242965"
     }
   ]
 },
 {
   "featureType": "poi",
   "elementType": "geometry",
   "stylers": [
     {
       "color": "#eeeeee"
     }
   ]
 },
 {
   "featureType": "poi",
   "elementType": "labels.text",
   "stylers": [
     {
       "visibility": "off"
     }
   ]
 },
 {
   "featureType": "poi",
   "elementType": "labels.text.fill",
   "stylers": [
     {
       "color": "#757575"
     }
   ]
 },
 {
   "featureType": "poi.park",
   "elementType": "geometry",
   "stylers": [
     {
       "color": "#e5e5e5"
     }
   ]
 },
 {
   "featureType": "poi.park",
   "elementType": "labels.text.fill",
   "stylers": [
     {
       "color": "#9e9e9e"
     }
   ]
 },
 {
   "featureType": "road",
   "elementType": "geometry",
   "stylers": [
     {
       "color": "#ffffff"
     }
   ]
 },
 {
   "featureType": "road.arterial",
   "elementType": "labels.text.fill",
   "stylers": [
     {
       "color": "#757575"
     }
   ]
 },
 {
   "featureType": "road.highway",
   "elementType": "geometry",
   "stylers": [
     {
       "color": "#dadada"
     }
   ]
 },
 {
   "featureType": "road.highway",
   "elementType": "labels.text.fill",
   "stylers": [
     {
       "color": "#616161"
     }
   ]
 },
 {
   "featureType": "road.local",
   "elementType": "labels",
   "stylers": [
     {
       "visibility": "off"
     }
   ]
 },
 {
   "featureType": "road.local",
   "elementType": "labels.text.fill",
   "stylers": [
     {
       "color": "#9e9e9e"
     }
   ]
 },
 {
   "featureType": "transit.line",
   "elementType": "geometry",
   "stylers": [
     {
       "color": "#e5e5e5"
     }
   ]
 },
 {
   "featureType": "transit.station",
   "elementType": "geometry",
   "stylers": [
     {
       "color": "#eeeeee"
     }
   ]
 },
 {
   "featureType": "water",
   "elementType": "geometry",
   "stylers": [
     {
       "color": "#c9c9c9"
     }
   ]
 },
 {
   "featureType": "water",
   "elementType": "labels.text.fill",
   "stylers": [
     {
       "color": "#9e9e9e"
     }
   ]
 }
];
        smartMap.styleMap('smartmap-mapcanvas-1', styles);
    });
{% endjs %}

{% endblock %}